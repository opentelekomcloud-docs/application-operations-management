:original_name: aom_04_1012.html

.. _aom_04_1012:

Querying Monitoring Data
========================

Function
--------

This API is used to query monitoring data of metrics within a specified time period. You can specify a dimension or period to query data.

URI
---

POST /v2/{project_id}/ams/metricdata

:ref:`Table 1 <aom_04_1012__table113891249135611>` describes the parameters.

.. _aom_04_1012__table113891249135611:

.. table:: **Table 1** Parameters

   +-------------+-------------+-------------+--------------------------+------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter   | Mandatory   | Type        | Value Range              | Description                                                                                                                                    |
   +=============+=============+=============+==========================+================================================================================================================================================+
   | project_id  | Yes         | String      | ``-``                    | Project ID obtained from IAM. Generally, a project ID contains 32 characters.                                                                  |
   +-------------+-------------+-------------+--------------------------+------------------------------------------------------------------------------------------------------------------------------------------------+
   | fillValue   | No          | String      | -1, 0, null, and average | Filled value for breakpoints in monitoring data. Default value: -1.                                                                            |
   |             |             |             |                          |                                                                                                                                                |
   |             |             |             |                          | -  -1: Breakpoints are filled with -1.                                                                                                         |
   |             |             |             |                          | -  0: Breakpoints are filled with 0.                                                                                                           |
   |             |             |             |                          | -  null: Breakpoints are filled with null.                                                                                                     |
   |             |             |             |                          | -  average: Breakpoints are filled with the average value of adjacent valid data. If there is no valid data, breakpoints are filled with null. |
   +-------------+-------------+-------------+--------------------------+------------------------------------------------------------------------------------------------------------------------------------------------+

Request
-------

**Request parameters**

:ref:`Table 2 <aom_04_1012__table539122593914>` describes the request parameters.

.. _aom_04_1012__table539122593914:

.. table:: **Table 2** Request parameters

   +-------------+-------------+-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter   | Mandatory   | Type        | Value Range                                                                                                                                                                                                                           | Description                                                                                                                                                                                                   |
   +=============+=============+=============+=======================================================================================================================================================================================================================================+===============================================================================================================================================================================================================+
   | metrics     | Yes         | JSON array  | A maximum of 20 metrics are supported. See :ref:`Table 3 <aom_04_1012__table1357332718015>`.                                                                                                                                          | List of metrics.                                                                                                                                                                                              |
   +-------------+-------------+-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | period      | Yes         | Integer     | Enumerated value. Options:                                                                                                                                                                                                            | Data monitoring granularity.                                                                                                                                                                                  |
   |             |             |             |                                                                                                                                                                                                                                       |                                                                                                                                                                                                               |
   |             |             |             | -  60: The data monitoring granularity is 1 minute.                                                                                                                                                                                   |                                                                                                                                                                                                               |
   |             |             |             | -  300: The data monitoring granularity is 5 minutes.                                                                                                                                                                                 |                                                                                                                                                                                                               |
   |             |             |             | -  900: The data monitoring granularity is 15 minutes.                                                                                                                                                                                |                                                                                                                                                                                                               |
   |             |             |             | -  3600: The data monitoring granularity is 1 hour.                                                                                                                                                                                   |                                                                                                                                                                                                               |
   +-------------+-------------+-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | timerange   | Yes         | String      | Format: start time (UTC, in ms).end time (UTC, in ms).number of minutes in the time period. When the start time and end time are -1, it indicates the latest *N* minutes. *N* indicates the time period by the granularity of minute. | Query time period. For example, **-1.-1.5** indicates the last 5 minutes. **1501545600000.1501632000000.1440** indicates the fixed time period from 08:00:00 on August 1, 2017 to 08:00:00 on August 2, 2017. |
   |             |             |             |                                                                                                                                                                                                                                       |                                                                                                                                                                                                               |
   |             |             |             |                                                                                                                                                                                                                                       | .. note::                                                                                                                                                                                                     |
   |             |             |             |                                                                                                                                                                                                                                       |                                                                                                                                                                                                               |
   |             |             |             |                                                                                                                                                                                                                                       |    Time range/Period <= 1440                                                                                                                                                                                  |
   |             |             |             |                                                                                                                                                                                                                                       |                                                                                                                                                                                                               |
   |             |             |             |                                                                                                                                                                                                                                       |    The **timerange** and **period** must use the same unit.                                                                                                                                                   |
   +-------------+-------------+-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | statistics  | Yes         | JSON array  | maximum, minimum, sum, average, or sampleCount.                                                                                                                                                                                       | Statistic.                                                                                                                                                                                                    |
   +-------------+-------------+-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _aom_04_1012__table1357332718015:

.. table:: **Table 3** metrics parameters

   +-------------+-------------+-------------+---------------------------------------------------------------------------------------+-------------------------------------------------------------------------+
   | Parameter   | Mandatory   | Type        | Value Range                                                                           | Description                                                             |
   +=============+=============+=============+=======================================================================================+=========================================================================+
   | namespace   | Yes         | String      | PAAS.CONTAINER, PAAS.NODE, PAAS.SLA, PAAS.AGGR, and CUSTOMMETRICS.                    | Metric namespace.                                                       |
   +-------------+-------------+-------------+---------------------------------------------------------------------------------------+-------------------------------------------------------------------------+
   | metricName  | Yes         | String      | 1-255 characters.                                                                     | Metric name.                                                            |
   +-------------+-------------+-------------+---------------------------------------------------------------------------------------+-------------------------------------------------------------------------+
   | dimensions  | Yes         | JSON array  | Neither the array nor the name/value of any dimension in the array can be left blank. | Metric dimension.                                                       |
   |             |             |             |                                                                                       |                                                                         |
   |             |             |             |                                                                                       | dimensions.name: dimension name. Example: appName.                      |
   |             |             |             |                                                                                       |                                                                         |
   |             |             |             |                                                                                       | dimensions.value: dimension value, such as a specific application name. |
   +-------------+-------------+-------------+---------------------------------------------------------------------------------------+-------------------------------------------------------------------------+

**Request headers**

:ref:`Table 4 <aom_04_1012__table17428844137>` describes the request headers.

.. _aom_04_1012__table17428844137:

.. table:: **Table 4** Request headers

   ============ ========= ============================================
   Name         Mandatory Description
   ============ ========= ============================================
   X-Auth-Token Yes       User token obtained from IAM.
   Content-Type Yes       Content type, which is **application/json**.
   ============ ========= ============================================

**Example request**

.. code-block::

   {
       "metrics": [
           {
               "namespace": "abc",
               "metricName": "def",
               "dimensions": [
                   {
                       "name": "instance_id",
                       "value": "demo1"
                   }
               ]
           }
       ],
       "period": 60,
       "timerange": "-1.-1.5",//Last 5 minutes
         "statistics": [
           "maximum",
           "minimum",
           "sum"
       ]
   }

Response
--------

**Response parameters**

:ref:`Table 5 <aom_04_1012__table538365710452>` describes the response parameters.

.. _aom_04_1012__table538365710452:

.. table:: **Table 5** Response parameters

   ============ =========== =================
   Parameter    Type        Description
   ============ =========== =================
   errorCode    String      Response code.
   errorMessage String      Response message.
   metrics      JSON object ``-``
   ============ =========== =================

**Example response**

.. code-block::

   {
       "errorCode": "AOM.0200",
       "errorMessage": "success",
       "metrics": [{
         "metric": {
           "namespace": "abc",
           "metricName": "def",
           "dimensions": [{
             "name": "ghi",
             "value": "lmn"
           }]
         },
         "dataPoints": [{
           "timestamp": 1467892800000,
           "unit": "Percent",
           "statistics": [{
             "statistic": "maximum",
             "value": 23
           }]
         }]
       }]
   }

Status Code
-----------

-  Success response

   :ref:`Table 6 <aom_04_1012__table86491459125016>` describes the status code.

   .. _aom_04_1012__table86491459125016:

   .. table:: **Table 6** Status code

      =========== ======= ==========================
      Status Code Message Description
      =========== ======= ==========================
      200         OK      The request has succeeded.
      =========== ======= ==========================

-  Error response

   :ref:`Table 7 <aom_04_1012__table939134985614>` describes the status codes. For more information, see :ref:`Status Codes <aom_04_0018>`.

   .. _aom_04_1012__table939134985614:

   .. table:: **Table 7** Status codes

      +-----------------------+-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Status Code           | Message               | Description                                                                                                                                                         |
      +=======================+=======================+=====================================================================================================================================================================+
      | 400                   | Bad Request           | The request is invalid.                                                                                                                                             |
      |                       |                       |                                                                                                                                                                     |
      |                       |                       | The client should not repeat the request without modifications.                                                                                                     |
      +-----------------------+-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 401                   | Unauthorized          | The authorization information provided by the client is incorrect or invalid.                                                                                       |
      +-----------------------+-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 403                   | Forbidden             | The request is rejected.                                                                                                                                            |
      |                       |                       |                                                                                                                                                                     |
      |                       |                       | The server has received the request and understood it, but the server is refusing to respond to it. The client should not repeat the request without modifications. |
      +-----------------------+-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 500                   | Internal Server Error | The server is able to receive the request but unable to understand the request.                                                                                     |
      +-----------------------+-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 503                   | Service Unavailable   | The requested service is invalid.                                                                                                                                   |
      |                       |                       |                                                                                                                                                                     |
      |                       |                       | The client should not repeat the request without modifications.                                                                                                     |
      +-----------------------+-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Error Code
----------

.. table:: **Table 8** Error codes

   +------------+---------------------------------------------------------+-------------------------------------------------+
   | Error Code | Message                                                 | Solution                                        |
   +============+=========================================================+=================================================+
   | AOM.0101   | Projectid is left blank.                                | Check whether the parameter meets requirements. |
   +------------+---------------------------------------------------------+-------------------------------------------------+
   | AOM.0102   | The metric data parameter is null.                      | Check whether the parameter meets requirements. |
   +------------+---------------------------------------------------------+-------------------------------------------------+
   | AOM.0103   | Invalid period.                                         | Check whether the parameter meets requirements. |
   +------------+---------------------------------------------------------+-------------------------------------------------+
   | AOM.0104   | Invalid statistics.                                     | Check whether the parameter meets requirements. |
   +------------+---------------------------------------------------------+-------------------------------------------------+
   | AOM.0105   | Invalid metrics.                                        | Check whether the parameter meets requirements. |
   +------------+---------------------------------------------------------+-------------------------------------------------+
   | AOM.0106   | Invalid time range.                                     | Check whether the parameter meets requirements. |
   +------------+---------------------------------------------------------+-------------------------------------------------+
   | AOM.0107   | The number of data points in a time range exceeds 1440. | Check whether the parameter meets requirements. |
   +------------+---------------------------------------------------------+-------------------------------------------------+
   | AOM.0110   | Invalid fillValue.                                      | Check whether the parameter meets requirements. |
   +------------+---------------------------------------------------------+-------------------------------------------------+
   | AOM.0500   | Internal server error.                                  | Contact technical support.                      |
   +------------+---------------------------------------------------------+-------------------------------------------------+
