:original_name: ShowMetricsData.html

.. _ShowMetricsData:

Querying Monitoring Data
========================

Function
--------

This API is used to query monitoring data of metrics within a specified time period. You can specify a dimension or period to query.

URI
---

POST /v1/{project_id}/ams/metricdata

.. table:: **Table 1** Path Parameters

   +------------+-----------+--------+-------------------------------------------------------------------------------+
   | Parameter  | Mandatory | Type   | Description                                                                   |
   +============+===========+========+===============================================================================+
   | project_id | Yes       | String | Project ID obtained from IAM. Generally, a project ID contains 32 characters. |
   +------------+-----------+--------+-------------------------------------------------------------------------------+

.. table:: **Table 2** Query Parameters

   +-----------------+-----------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter       | Mandatory       | Type            | Description                                                                                                                                                                                                                                                                                                                       |
   +=================+=================+=================+===================================================================================================================================================================================================================================================================================================================================+
   | fillValue       | No              | String          | Value filled for breakpoints in monitoring data. Default value: -1. -1: Breakpoints are filled with -1. 0: Breakpoints are filled with 0. null: Breakpoints are filled with null. average: Breakpoints are filled with the average value of the adjacent valid data. If there is no valid data, breakpoints are filled with null. |
   |                 |                 |                 |                                                                                                                                                                                                                                                                                                                                   |
   |                 |                 |                 | Default: **-1**                                                                                                                                                                                                                                                                                                                   |
   |                 |                 |                 |                                                                                                                                                                                                                                                                                                                                   |
   |                 |                 |                 | Enumeration values:                                                                                                                                                                                                                                                                                                               |
   |                 |                 |                 |                                                                                                                                                                                                                                                                                                                                   |
   |                 |                 |                 | -  **-1**                                                                                                                                                                                                                                                                                                                         |
   |                 |                 |                 |                                                                                                                                                                                                                                                                                                                                   |
   |                 |                 |                 | -  **0**                                                                                                                                                                                                                                                                                                                          |
   |                 |                 |                 |                                                                                                                                                                                                                                                                                                                                   |
   |                 |                 |                 | -  **null**                                                                                                                                                                                                                                                                                                                       |
   |                 |                 |                 |                                                                                                                                                                                                                                                                                                                                   |
   |                 |                 |                 | -  **average**                                                                                                                                                                                                                                                                                                                    |
   +-----------------+-----------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Request Parameters
------------------

.. table:: **Table 3** Request header parameters

   +-----------------+-----------------+-----------------+------------------------------------------+
   | Parameter       | Mandatory       | Type            | Description                              |
   +=================+=================+=================+==========================================+
   | X-Auth-Token    | Yes             | String          | User token obtained from IAM.            |
   +-----------------+-----------------+-----------------+------------------------------------------+
   | Content-Type    | Yes             | String          | Content type, which is application/json. |
   |                 |                 |                 |                                          |
   |                 |                 |                 | Enumeration values:                      |
   |                 |                 |                 |                                          |
   |                 |                 |                 | -  **application/json**                  |
   +-----------------+-----------------+-----------------+------------------------------------------+

.. table:: **Table 4** Request body parameters

   +-----------------+-----------------+--------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter       | Mandatory       | Type                                                                                             | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
   +=================+=================+==================================================================================================+===============================================================================================================================================================================================================================================================================================================================================================================================================================================================+
   | metrics         | Yes             | Array of :ref:`MetricQueryMeritcParam <showmetricsdata__request_metricquerymeritcparam>` objects | Metric list. A JSON array can contain up to 20 objects.                                                                                                                                                                                                                                                                                                                                                                                                       |
   +-----------------+-----------------+--------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | period          | Yes             | Integer                                                                                          | Granularity for monitoring data, which is an enumerated value. Values: 60: The data monitoring granularity is 1 minute. 300: The data monitoring granularity is 5 minutes. 900: The data monitoring granularity is 15 minutes. 3600: The data monitoring granularity is 1 hour.                                                                                                                                                                               |
   +-----------------+-----------------+--------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | statistics      | Yes             | Array of strings                                                                                 | Statistic. Values: maximum, minimum, sum, average, and sampleCount.                                                                                                                                                                                                                                                                                                                                                                                           |
   +-----------------+-----------------+--------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | timerange       | Yes             | String                                                                                           | Time range specified to query data of the last N minutes when the client time is inconsistent with the server time. It can also be used to accurately query the data of a specified period.                                                                                                                                                                                                                                                                   |
   |                 |                 |                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   |                 |                 |                                                                                                  | Example:                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                 |                 |                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   |                 |                 |                                                                                                  | -  -1.-1.60: indicates that the data of the latest 60 minutes is queried. This query is based on the server time regardless of the current client time.                                                                                                                                                                                                                                                                                                       |
   |                 |                 |                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   |                 |                 |                                                                                                  | -  1650852000000.1650852300000.5: indicates the five minutes from 10:00:00 to 10:05:00 on April 25, 2022 GMT+08:00.                                                                                                                                                                                                                                                                                                                                           |
   |                 |                 |                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   |                 |                 |                                                                                                  | Format:                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                 |                 |                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   |                 |                 |                                                                                                  | startTimeInMillis.endTimeInMillis.durationInMinutes                                                                                                                                                                                                                                                                                                                                                                                                           |
   |                 |                 |                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   |                 |                 |                                                                                                  | Parameter description:                                                                                                                                                                                                                                                                                                                                                                                                                                        |
   |                 |                 |                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   |                 |                 |                                                                                                  | -  startTimeInMillis: Start time of the query, in milliseconds. If this parameter is set to -1, the server calculates the start time as follows: endTimeInMillis - durationInMinutes x 60 x 1000. For example, -1.1650852300000.5 is equivalent to 1650852000000.1650852300000.5.                                                                                                                                                                             |
   |                 |                 |                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   |                 |                 |                                                                                                  | -  endTimeInMillis: End time of the query, in milliseconds. If this parameter is set to -1, the server calculates the end time as follows: startTimeInMillis + durationInMinutes x 60 x 1000. If the calculated end time is later than the current system time, the current system time is used. For example, 1650852000000.-1.5 is equivalent to 1650852000000.1650852300000.5.                                                                              |
   |                 |                 |                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   |                 |                 |                                                                                                  | -  durationInMinutes: Time span, in minutes. The value must be greater than 0 and greater than or equal to the result of "(endTimeInMillis - startTimeInMillis)/(60 x 1000) - 1". If both the start time and end time are set to -1, the system sets the end time to the current UTC time (in milliseconds) and calculates the start time as follows: endTimeInMillis - durationInMinutes x 60 x 1000. For example, -1.-1.60 indicates the latest 60 minutes. |
   |                 |                 |                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   |                 |                 |                                                                                                  | Constraint:                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
   |                 |                 |                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   |                 |                 |                                                                                                  | In a single request, the following condition must be met: durationInMinutes x 60/period <= 1440                                                                                                                                                                                                                                                                                                                                                               |
   +-----------------+-----------------+--------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _showmetricsdata__request_metricquerymeritcparam:

.. table:: **Table 5** MetricQueryMeritcParam

   +------------+-----------+------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter  | Mandatory | Type                                                                   | Description                                                                                                                                                                                                                                                                                                        |
   +============+===========+========================================================================+====================================================================================================================================================================================================================================================================================================================+
   | dimensions | Yes       | Array of :ref:`Dimension <showmetricsdata__request_dimension>` objects | List of metric dimensions. Neither the array nor the name or value of any dimension in the array can be left blank.                                                                                                                                                                                                |
   +------------+-----------+------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | metricName | Yes       | String                                                                 | Metric name. Length: 1 to 255 characters. Value range: cpuUsage, cpuCoreUsed, and other basic metrics provided by AOM. cpuUsage: CPU usage. cpuCoreUsed: used CPU cores. Custom metrics.                                                                                                                           |
   +------------+-----------+------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | namespace  | Yes       | String                                                                 | Metric namespace. Values: PAAS.CONTAINER: namespace of component, instance, process, and container metrics. PAAS.NODE: namespace of host, network, disk, and file system metrics. PAAS.SLA: namespace of SLA metrics. PAAS.AGGR: namespace of cluster metrics. CUSTOMMETRICS: default namespace of custom metrics. |
   +------------+-----------+------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _showmetricsdata__request_dimension:

.. table:: **Table 6** Dimension

   ========= ========= ====== ================
   Parameter Mandatory Type   Description
   ========= ========= ====== ================
   name      Yes       String Dimension name.
   value     Yes       String Dimension value.
   ========= ========= ====== ================

Response Parameters
-------------------

**Status code: 200**

.. table:: **Table 7** Response body parameters

   +--------------+-------------------------------------------------------------------------------------+-------------------+
   | Parameter    | Type                                                                                | Description       |
   +==============+=====================================================================================+===================+
   | errorCode    | String                                                                              | Response code.    |
   +--------------+-------------------------------------------------------------------------------------+-------------------+
   | errorMessage | String                                                                              | Response message. |
   +--------------+-------------------------------------------------------------------------------------+-------------------+
   | metrics      | Array of :ref:`MetricDataValue <showmetricsdata__response_metricdatavalue>` objects | Metric list.      |
   +--------------+-------------------------------------------------------------------------------------+-------------------+

.. _showmetricsdata__response_metricdatavalue:

.. table:: **Table 8** MetricDataValue

   +------------+-----------------------------------------------------------------------------------------+-------------------+
   | Parameter  | Type                                                                                    | Description       |
   +============+=========================================================================================+===================+
   | dataPoints | Array of :ref:`MetricDataPoints <showmetricsdata__response_metricdatapoints>` objects   | Key metric.       |
   +------------+-----------------------------------------------------------------------------------------+-------------------+
   | metric     | :ref:`MetricQueryMeritcParam <showmetricsdata__response_metricquerymeritcparam>` object | Query parameters. |
   +------------+-----------------------------------------------------------------------------------------+-------------------+

.. _showmetricsdata__response_metricdatapoints:

.. table:: **Table 9** MetricDataPoints

   +------------+-----------------------------------------------------------------------------------+-------------------+
   | Parameter  | Type                                                                              | Description       |
   +============+===================================================================================+===================+
   | statistics | Array of :ref:`StatisticValue <showmetricsdata__response_statisticvalue>` objects | Statistic.        |
   +------------+-----------------------------------------------------------------------------------+-------------------+
   | timestamp  | Long                                                                              | Timestamp.        |
   +------------+-----------------------------------------------------------------------------------+-------------------+
   | unit       | String                                                                            | Time series unit. |
   +------------+-----------------------------------------------------------------------------------+-------------------+

.. _showmetricsdata__response_statisticvalue:

.. table:: **Table 10** StatisticValue

   ========= ====== ===================
   Parameter Type   Description
   ========= ====== ===================
   statistic String Statistic.
   value     Double Statistical result.
   ========= ====== ===================

.. _showmetricsdata__response_metricquerymeritcparam:

.. table:: **Table 11** MetricQueryMeritcParam

   +------------+-------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter  | Type                                                                    | Description                                                                                                                                                                                                                                                                                                        |
   +============+=========================================================================+====================================================================================================================================================================================================================================================================================================================+
   | dimensions | Array of :ref:`Dimension <showmetricsdata__response_dimension>` objects | List of metric dimensions. Neither the array nor the name or value of any dimension in the array can be left blank.                                                                                                                                                                                                |
   +------------+-------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | metricName | String                                                                  | Metric name. Length: 1 to 255 characters. Value range: cpuUsage, cpuCoreUsed, and other basic metrics provided by AOM. cpuUsage: CPU usage. cpuCoreUsed: used CPU cores. Custom metrics.                                                                                                                           |
   +------------+-------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | namespace  | String                                                                  | Metric namespace. Values: PAAS.CONTAINER: namespace of component, instance, process, and container metrics. PAAS.NODE: namespace of host, network, disk, and file system metrics. PAAS.SLA: namespace of SLA metrics. PAAS.AGGR: namespace of cluster metrics. CUSTOMMETRICS: default namespace of custom metrics. |
   +------------+-------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _showmetricsdata__response_dimension:

.. table:: **Table 12** Dimension

   ========= ====== ================
   Parameter Type   Description
   ========= ====== ================
   name      String Dimension name.
   value     String Dimension value.
   ========= ====== ================

Example Requests
----------------

Query the monitoring data of **aom_process_cpu_usage** in the **PAAS.CONTAINER** namespace in the last five minutes.

.. code-block::

   https://{Endpoint}/v1/{project_id}/ams/metricdata

   {
     "metrics" : [ {
       "dimensions" : [ {
         "name" : "appName",
         "value" : "aomApp"
       } ],
       "metricName" : "aom_process_cpu_usage",
       "namespace" : "PAAS.CONTAINER"
     } ],
     "period" : 60,
     "statistics" : [ "maximum", "minimum", "sum" ],
     "timerange" : "-1.-1.5"
   }

Example Responses
-----------------

**Status code: 200**

OK: The request is successful.

.. code-block::

   {
     "errorCode" : "SVCSTG.AMS.2000",
     "errorMessage" : "success",
     "metrics" : [ {
       "metric" : {
         "namespace" : "PAAS.CONTAINER",
         "metricName" : "aom_process_cpu_usage",
         "dimensions" : [ {
           "name" : "appName",
           "value" : "aomApp"
         } ]
       },
       "dataPoints" : [ {
         "timestamp" : "1467892800000",
         "unit" : "Percent",
         "statistics" : [ {
           "statistic" : "maximum",
           "value" : "23"
         } ]
       } ]
     } ]
   }

Status Codes
------------

+-------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Status Code | Description                                                                                                                                                                                         |
+=============+=====================================================================================================================================================================================================+
| 200         | OK: The request is successful.                                                                                                                                                                      |
+-------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 400         | Bad Request: The request is invalid. The client should not repeat the request without modifications.                                                                                                |
+-------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 401         | Unauthorized: The authentication information is incorrect or invalid.                                                                                                                               |
+-------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 403         | Forbidden: The request is rejected. The server has received the request and understood it, but the server refuses to respond to it. The client should not repeat the request without modifications. |
+-------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 500         | Internal Server Error: The server is able to receive the request but unable to understand the request.                                                                                              |
+-------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 503         | Service Unavailable: The requested service is invalid. The client should not repeat the request without modifications.                                                                              |
+-------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Error Codes
-----------

See :ref:`Error Codes <errorcode>`.
