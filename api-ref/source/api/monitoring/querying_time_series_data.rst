:original_name: ListSample.html

.. _ListSample:

Querying Time Series Data
=========================

Function
--------

This API is used to query time series data within a specified time period. You can specify a dimension or period to query.

URI
---

POST /v2/{project_id}/samples

.. table:: **Table 1** Path Parameters

   +------------+-----------+--------+-------------------------------------------------------------------------------+
   | Parameter  | Mandatory | Type   | Description                                                                   |
   +============+===========+========+===============================================================================+
   | project_id | Yes       | String | Project ID obtained from IAM. Generally, a project ID contains 32 characters. |
   +------------+-----------+--------+-------------------------------------------------------------------------------+

.. table:: **Table 2** Query Parameters

   +------------+-----------+--------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter  | Mandatory | Type   | Description                                                                                                                                                                                                                                                                                                                        |
   +============+===========+========+====================================================================================================================================================================================================================================================================================================================================+
   | fill_value | No        | String | Value filled for breakpoints in time series data. Default value: -1. -1: Breakpoints are filled with -1. 0: Breakpoints are filled with 0. null: Breakpoints are filled with null. average: Breakpoints are filled with the average value of the adjacent valid data. If there is no valid data, breakpoints are filled with null. |
   +------------+-----------+--------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Request Parameters
------------------

.. table:: **Table 3** Request body parameters

   +-----------------+-----------------+-----------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter       | Mandatory       | Type                                                                  | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
   +=================+=================+=======================================================================+===============================================================================================================================================================================================================================================================================================================================================================================================================================================================+
   | samples         | Yes             | Array of :ref:`QuerySample <listsample__request_querysample>` objects | List of time series objects. A JSON array can contain up to 20 objects.                                                                                                                                                                                                                                                                                                                                                                                       |
   +-----------------+-----------------+-----------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | statistics      | Yes             | Array of strings                                                      | Statistic. Values: maximum, minimum, sum, average, and sampleCount.                                                                                                                                                                                                                                                                                                                                                                                           |
   +-----------------+-----------------+-----------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | period          | Yes             | Integer                                                               | Granularity for monitoring data, which is an enumerated value. Values: 60: The data monitoring granularity is 1 minute. 300: The data monitoring granularity is 5 minutes. 900: The data monitoring granularity is 15 minutes. 3600: The data monitoring granularity is 1 hour.                                                                                                                                                                               |
   +-----------------+-----------------+-----------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | time_range      | Yes             | String                                                                | Time range specified to query data of the last N minutes when the client time is inconsistent with the server time. It can also be used to accurately query the data of a specified period.                                                                                                                                                                                                                                                                   |
   |                 |                 |                                                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   |                 |                 |                                                                       | Example:                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                 |                 |                                                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   |                 |                 |                                                                       | -  -1.-1.60: indicates that the data of the latest 60 minutes is queried. This query is based on the server time regardless of the current client time.                                                                                                                                                                                                                                                                                                       |
   |                 |                 |                                                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   |                 |                 |                                                                       | -  1650852000000.1650852300000.5: indicates the five minutes from 10:00:00 to 10:05:00 on April 25, 2022 GMT+08:00.                                                                                                                                                                                                                                                                                                                                           |
   |                 |                 |                                                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   |                 |                 |                                                                       | Format:                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                 |                 |                                                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   |                 |                 |                                                                       | startTimeInMillis.endTimeInMillis.durationInMinutes                                                                                                                                                                                                                                                                                                                                                                                                           |
   |                 |                 |                                                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   |                 |                 |                                                                       | Parameter description:                                                                                                                                                                                                                                                                                                                                                                                                                                        |
   |                 |                 |                                                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   |                 |                 |                                                                       | -  startTimeInMillis: Start time of the query, in milliseconds. If this parameter is set to -1, the server calculates the start time as follows: endTimeInMillis - durationInMinutes x 60 x 1000. For example, -1.1650852300000.5 is equivalent to 1650852000000.1650852300000.5.                                                                                                                                                                             |
   |                 |                 |                                                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   |                 |                 |                                                                       | -  endTimeInMillis: End time of the query, in milliseconds. If this parameter is set to -1, the server calculates the end time as follows: startTimeInMillis + durationInMinutes x 60 x 1000. If the calculated end time is later than the current system time, the current system time is used. For example, 1650852000000.-1.5 is equivalent to 1650852000000.1650852300000.5.                                                                              |
   |                 |                 |                                                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   |                 |                 |                                                                       | -  durationInMinutes: Time span, in minutes. The value must be greater than 0 and greater than or equal to the result of "(endTimeInMillis - startTimeInMillis)/(60 x 1000) - 1". If both the start time and end time are set to -1, the system sets the end time to the current UTC time (in milliseconds) and calculates the start time as follows: endTimeInMillis - durationInMinutes x 60 x 1000. For example, -1.-1.60 indicates the latest 60 minutes. |
   |                 |                 |                                                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   |                 |                 |                                                                       | Constraint:                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
   |                 |                 |                                                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   |                 |                 |                                                                       | In a single request, the following condition must be met: durationInMinutes x 60/period <= 1440                                                                                                                                                                                                                                                                                                                                                               |
   +-----------------+-----------------+-----------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _listsample__request_querysample:

.. table:: **Table 4** QuerySample

   +-------------+-----------+-------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter   | Mandatory | Type                                                                          | Description                                                                                                                                                                                                                                                                                                                                                                                   |
   +=============+===========+===============================================================================+===============================================================================================================================================================================================================================================================================================================================================================================================+
   | namespace   | Yes       | String                                                                        | Namespace of time series objects. Value range: PAAS.CONTAINER, PAAS.NODE, PAAS.SLA, PAAS.AGGR, or CUSTOMMETRICS. PAAS.CONTAINER: namespace of application time series objects. PAAS.NODE: namespace of node time series objects. PAAS.SLA: namespace of SLA time series objects. PAAS.AGGR: namespace of cluster time series objects. CUSTOMMETRICS: namespace of custom time series objects. |
   +-------------+-----------+-------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | dimensions  | Yes       | Array of :ref:`DimensionSeries <listsample__request_dimensionseries>` objects | List of time series dimensions.You can call the /v2/{project_id}/series API to query the time series dimension list by namespace and metric_name.                                                                                                                                                                                                                                             |
   +-------------+-----------+-------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | metric_name | Yes       | String                                                                        | Time series name. Length: 1 to 255 characters. Values: cpuUsage: CPU usage. cpuCoreUsed: used CPU cores. Custom time series names.                                                                                                                                                                                                                                                            |
   +-------------+-----------+-------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _listsample__request_dimensionseries:

.. table:: **Table 5** DimensionSeries

   ========= ========= ====== ================
   Parameter Mandatory Type   Description
   ========= ========= ====== ================
   name      No        String Dimension name.
   value     No        String Dimension value.
   ========= ========= ====== ================

Response Parameters
-------------------

**Status code: 200**

.. table:: **Table 6** Response body parameters

   +-----------+--------------------------------------------------------------------------------+------------------------------+
   | Parameter | Type                                                                           | Description                  |
   +===========+================================================================================+==============================+
   | samples   | Array of :ref:`SampleDataValue <listsample__response_sampledatavalue>` objects | List of time series objects. |
   +-----------+--------------------------------------------------------------------------------+------------------------------+

.. _listsample__response_sampledatavalue:

.. table:: **Table 7** SampleDataValue

   +-------------+----------------------------------------------------------------------------------+------------------------------+
   | Parameter   | Type                                                                             | Description                  |
   +=============+==================================================================================+==============================+
   | sample      | :ref:`QuerySample <listsample__response_querysample>` object                     | List of time series objects. |
   +-------------+----------------------------------------------------------------------------------+------------------------------+
   | data_points | Array of :ref:`MetricDataPoints <listsample__response_metricdatapoints>` objects | Time series data.            |
   +-------------+----------------------------------------------------------------------------------+------------------------------+

.. _listsample__response_querysample:

.. table:: **Table 8** QuerySample

   +-------------+--------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter   | Type                                                                           | Description                                                                                                                                                                                                                                                                                                                                                                                   |
   +=============+================================================================================+===============================================================================================================================================================================================================================================================================================================================================================================================+
   | namespace   | String                                                                         | Namespace of time series objects. Value range: PAAS.CONTAINER, PAAS.NODE, PAAS.SLA, PAAS.AGGR, or CUSTOMMETRICS. PAAS.CONTAINER: namespace of application time series objects. PAAS.NODE: namespace of node time series objects. PAAS.SLA: namespace of SLA time series objects. PAAS.AGGR: namespace of cluster time series objects. CUSTOMMETRICS: namespace of custom time series objects. |
   +-------------+--------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | dimensions  | Array of :ref:`DimensionSeries <listsample__response_dimensionseries>` objects | List of time series dimensions.You can call the /v2/{project_id}/series API to query the time series dimension list by namespace and metric_name.                                                                                                                                                                                                                                             |
   +-------------+--------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | metric_name | String                                                                         | Time series name. Length: 1 to 255 characters. Values: cpuUsage: CPU usage. cpuCoreUsed: used CPU cores. Custom time series names.                                                                                                                                                                                                                                                            |
   +-------------+--------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _listsample__response_dimensionseries:

.. table:: **Table 9** DimensionSeries

   ========= ====== ================
   Parameter Type   Description
   ========= ====== ================
   name      String Dimension name.
   value     String Dimension value.
   ========= ====== ================

.. _listsample__response_metricdatapoints:

.. table:: **Table 10** MetricDataPoints

   +------------+------------------------------------------------------------------------------+-------------------+
   | Parameter  | Type                                                                         | Description       |
   +============+==============================================================================+===================+
   | statistics | Array of :ref:`StatisticValue <listsample__response_statisticvalue>` objects | Statistic.        |
   +------------+------------------------------------------------------------------------------+-------------------+
   | timestamp  | Long                                                                         | Timestamp.        |
   +------------+------------------------------------------------------------------------------+-------------------+
   | unit       | String                                                                       | Time series unit. |
   +------------+------------------------------------------------------------------------------+-------------------+

.. _listsample__response_statisticvalue:

.. table:: **Table 11** StatisticValue

   ========= ====== ===================
   Parameter Type   Description
   ========= ====== ===================
   statistic String Statistic.
   value     Double Statistical result.
   ========= ====== ===================

**Status code: 400**

.. table:: **Table 12** Response body parameters

   ========== ====== ==============
   Parameter  Type   Description
   ========== ====== ==============
   error_code String Error code.
   error_msg  String Error message.
   error_type String Error type.
   ========== ====== ==============

Example Requests
----------------

Query time series data in the last five minutes by namespace, metric_name, and dimensions.

.. code-block::

   https://{Endpoint}/v2/{project_id}/samples

   {
       "samples": [
           {
               "namespace": "PAAS.CONTAINER",
               "metric_name": "aom_process_cpu_usage",
               "dimensions": [
                   {
                       "name": "appName",
                       "value": "aomApp"
                   }
               ]
           }
       ],
       "period": 60,
       "time_range": "-1.-1.5",// Last 5 minutes
         "statistics": [
           "sum"
       ]
   }

Example Responses
-----------------

**Status code: 200**

OK: The request is successful.

.. code-block::

   {
     "samples" : [ {
       "sample" : {
         "namespace" : "PAAS.CONTAINER",
         "metric_name" : "aom_process_cpu_usage",
         "dimensions" : [ {
           "name" : "appName",
           "value" : "aomApp"
         } ]
       },
       "data_points" : [ {
         "timestamp" : "1694673300000",
         "unit" : "Percent",
         "statistics" : [ {
           "statistic" : "sum",
           "value" : "23"
         } ]
       } ]
     } ]
   }

**Status code: 400**

Bad Request: The request is invalid. The client should not repeat the request without modifications.

.. code-block::

   {
     "error_code" : "AOM.04008001",
     "error_msg" : "please check request param",
     "error_type" : "BAD_REQUEST"
   }

Status Codes
------------

+-------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Status Code | Description                                                                                                                                                                                         |
+=============+=====================================================================================================================================================================================================+
| 200         | OK: The request is successful.                                                                                                                                                                      |
+-------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 400         | Bad Request: The request is invalid. The client should not repeat the request without modifications.                                                                                                |
+-------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 401         | Unauthorized: The authentication information is incorrect or invalid.                                                                                                                               |
+-------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 403         | Forbidden: The request is rejected. The server has received the request and understood it, but the server refuses to respond to it. The client should not repeat the request without modifications. |
+-------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 500         | Internal Server Error: The server is able to receive the request but unable to understand the request.                                                                                              |
+-------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 503         | Service Unavailable: The requested service is invalid. The client should not repeat the request without modifications.                                                                              |
+-------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Error Codes
-----------

See :ref:`Error Codes <errorcode>`.
